---
title: "NOAA Weather Population Health And Economic Damage Analysis"
output: 
  html_document:
    keep_md: true
  pdf_document
---
# Title: NOAA Weather Population Health And Economic Damage Analysis from Storm

# Synopsis
An analysis of 
U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage. This report researches
* which types of events (as indicated in the EVTYPE variable) are most harmful to population health?
* which types of events have the greatest economic consequences?

For background of project, please refer to [README.md](https://github.com/linearregression/RepData_PeerAssessment2/blob/master/README.md)

# Data Processing
## Download data from source
```{r download, echo=TRUE}
rm(list=ls())
require(utils)
targetfile <- 'StormData.csv'
zipData <- paste(targetfile,'.bz2', sep='')

if(!file.exists(zipData)) {
   print('Downloading StormData.zip ....')   
   download.file(url='https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2', destfile=zipData, method='curl')
}

```
## Loading and preprocessing the data
For the two questions to research only columns are relevant:
BGN_DATE for time,
FATALITIES, "INJURIES for population health
PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP - for property and crop damages and their corresponding numeric exponents

 [1] "STATE__"    "BGN_DATE"   "BGN_TIME"   "TIME_ZONE"  "COUNTY"    
 [6] "COUNTYNAME" "STATE"      "EVTYPE"     "BGN_RANGE"  "BGN_AZI"   
[11] "BGN_LOCATI" "END_DATE"   "END_TIME"   "COUNTY_END" "COUNTYENDN"
[16] "END_RANGE"  "END_AZI"    "END_LOCATI" "LENGTH"     "WIDTH"     
[21] "F"          "MAG"        "FATALITIES" "INJURIES"   "PROPDMG"   
[26] "PROPDMGEXP" "CROPDMG"    "CROPDMGEXP" "WFO"        "STATEOFFIC"
[31] "ZONENAMES"  "LATITUDE"   "LONGITUDE"  "LATITUDE_E" "LONGITUDE_"
[36] "REMARKS"    "REFNUM" 


Load data from csv
```{r loaddata, echo=TRUE}
require(utils)
require(data.table)
columns <-c("NULL", "character", rep("NULL", 5), "character", rep("NULL", 14), rep("character", 5),'character', rep("NULL", 9))
stormdata <- read.csv2(file=zipData, header=TRUE, sep=",", stringsAsFactor=FALSE,  strip.white = TRUE, skipNul = TRUE, colClasses= columns)

# Find how many events
events <- unique(stormdata$EVTYPE)
population_health <- c("FATALITIES", "INJURIES")
# Get the Unit exponent for dollar amount damage
propertydamage_exp <- unique(stormdata$PROPDMGEXP))
cropdamage_exp <- unique(stormdata$CROPDMGEXP))

```
# Cleanse data
## Event entries inconsistency
There are extra leading and trailing whitespaces, mixes cases in entries. All entries normalized to lower case and have whitespaces trimmed.

## Events collection inconsistency 
Events are collected and categorized differently from 1950-2014. For example, only Tornado is collected from 1950 to 1954; Tornado, Thunderstorm Wind and Hail from 1955 to 1992; but from 1996 onwards 48 event types are recorded.
Since we missing data is not zero, we cannot compare data in different period. This restricts the analyse to compare 1996 to present. 

# Dollar damage exponents inconsistency
Some property and crop damage dollar amounts are recorded in two columns.
Base dollar amount in respective DMG, unit exponent in DMGEXP.
The total dollar amount need to be noralized from both DM and DMGEXP.
For example for property damanage 100 as 1 in PROPDMG, H or h in PROPDMGEXP. 
All non-numeric characters are normalzed to lower case and are limited to h,k,m,b (hundreds, thousand, million, billion).
Numeric characters are conerted to integer.
All others as 0, to be converted to 10^0 which is 1.



``` {r cleansedata, echo=TRUE}
require(stringr)
stormdata$EVTYPE<-as.vector(tolower(str_trim(stormdata$EVTYPE)))
stormdata$PropertyDamage <-
stormdata$cropDamage <- 

```


The scope of events related harmful to population health are:

# Analysis
``` {r, analysis, echo=TRUE}


```
# Results.


## Publishing Results
``` {r rpublish, echo=TRUE}
title <- "NOAA Weather Population Health And Economic Damage Analysis"
html <- "PA2_template.html"
result <- rpubsUpload(title, html)
if (!is.null(result$continueUrl)) 
    browseURL(result$continueUrl) else stop(result$error)

# update the same document with a new title
updateResult <- rpubsUpload(title, html, result$id)

```

