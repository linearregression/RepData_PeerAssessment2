---
title: "NOAA Weather Population Health And Economic Damage Analysis"
output: 
  html_document:
    keep_md: true
  pdf_document
---
# Title: NOAA Weather Population Health And Economic Damage Analysis from Storm

# Synopsis

From analysis of NOAA storm data for years 1950-2011, an emprical comparison is performed toinvestigate which weathe events are most costly in terms of US dollars and havig most damages to population health.

No inflation adjustment in dollars is made. Comparison is later restricted from 1995 to 2014 because of events collections changes, and missing data cannot be treated as zero.

For background of project, please refer to [README.md](https://github.com/linearregression/RepData_PeerAssessment2/blob/master/README.md)

# Data Processing
## Download data from source
```{r download, echo=TRUE}
rm(list=ls())
targetfile <- 'StormData.csv'
zipData <- paste(targetfile,'.bz2', sep='')

if(!file.exists(zipData)) {
   print('Downloading StormData.zip ....')   
   download.file(url='https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2', destfile=zipData, method='curl')
}

```
## Loading and preprocessing the data
For the two questions to research only columns are relevant:
BGN_DATE for time,
FATALITIES, "INJURIES for population health
PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP - for property and crop damages and their corresponding numeric exponents

Load data from csv
```{r loaddata, echo=TRUE}
require(utils) || install.packages('utils')
require(data.table) || install.packages('data.table')
columns <-c("NULL", "character", rep("NULL", 5), "character", rep("NULL", 14), rep("character", 5),'character', rep("NULL", 9))
stormdata <- read.csv2(file=zipData, header=TRUE, sep=",", stringsAsFactor=FALSE,  strip.white = TRUE, skipNul = TRUE, colClasses= columns)

# Find how many events
events <- unique(stormdata$EVTYPE)
population_health <- c("FATALITIES", "INJURIES")
# Get the Unit exponent for dollar amount damage of property and crops
propertydamage_exp <- unique(stormdata$PROPDMGEXP)
cropdamage_exp <- unique(stormdata$CROPDMGEXP)

```
# Cleanse data
## Event entries inconsistency
Event names are trimmed of leading and trailing whitespaces and normalized o lowercases. Events are not recategorized avoiding changing any original assumptions.

## Events collection inconsistency 
Events categorizations and data collections expands from 1950-2014. For example, only Tornado is collected from 1950 to 1954; but from 1996 onwards 48 event types are recorded.
Since missing data does not equates zero effect, the analysis to compare 1996 to present when collections methods are uniform and data most recent.

# Dollar damage exponents inconsistency
Some property and crop damage dollar amounts are recorded in two columns.
Base dollar amount in respective DMG, unit exponent in DMGEXP.
The total dollar amount need to be noralized from both DM and DMGEXP.
For example for property damanage 100 as 1 in PROPDMG, H or h in PROPDMGEXP. 
All non-numeric characters are normalzed to lower case and are limited to h,k,m,b (hundreds, thousand, million, billion).
Numeric characters are conerted to integer.
All others as 0, to be converted to 10^0 which is 1.

``` {r cleansedata, echo=TRUE}
require(stringr) || install.packages('stringr')
clean_exp <- function(x){
             x <- tolower(x)
             x <- gsub('', '0', x=x)
             x <- gsub('[\?\+\-]', '0', x=x)
             x <- gsub('+', '0', x=x)
             x <- gsub('-', replacement='0', x=x)
             as.numeric(x)
         }
propertydamage_exp <- unique(stormdata$PROPDMGEXP)
cropdamage_exp <- unique(stormdata$CROPDMGEXP)


stormdata$YEAR <-format(as.Date(stormdata$BGN_DATE , "%m/%d/%Y"), "%Y", drop0trailing=TRUE)
# only consider fro year 1995 to 2014
stormdata <- stormdata[stormdata$YEAR >= 1995 & stormdata$YEAR <= 2014,] 
# Trim leading and trailing whitespace, tolower case.
stormdata$EVTYPE <- as.vector(tolower(str_trim(stormdata$EVTYPE)))
stormdata$PROPDMGEXP <- as.vector(tolower(str_trim(stormdata$PROPDMGEXP)))
stormdata$CROPDMGEXP <- as.vector(tolower(str_trim(stormdata$CROPDMGEXP)))

# Group injuries and fatalies as population_safty


# Group property damage and crop damage as econmoic_damage


# Summarise population_safty by events & rank total  


# Summarise econmoic_damageby events & rank total  



```


The scope of events related harmful to population health are:

# Analysis
``` {r, analysis, echo=TRUE}


```
# Results.
Tornado causes most economic damage, as well as damage to population health.




## Publishing Results
``` {r rpublish, echo=TRUE}
require(knitr) || install.packges('knitr')

title <- "NOAA Weather Population Health And Economic Damage Analysis"
html <- "PA2_template.html"
result <- rpubsUpload(title, html)
if (!is.null(result$continueUrl)) 
    browseURL(result$continueUrl) else stop(result$error)

# update the same document with a new title
updateResult <- rpubsUpload(title, html, result$id)

```

